syntax = "proto3";

package gpu.rentaler;

option java_package = "com.gpu.rentaler.grpc";
option java_outer_classname = "TaskAssignServiceProto";

import "google/protobuf/empty.proto";

// ================================
// 响应对象：容器信息
// ================================
message DContainerInfoResp {
    string containerName = 1; // 容器名称
    string containerId = 2;   // 容器ID
}

// ================================
// 请求对象：停止 Docker 容器
// ================================
message StopDockerContainerRequest {
    string containerId = 1;   // 目标容器ID
}

// ================================
// 请求对象：上传 Docker 镜像
// ================================
message UpDockerImageRequest {
    bytes imageFile = 1;              // Docker 镜像文件内容
    repeated int32 deviceIndexs = 2;  // GPU 设备索引列表
}

// ================================
// 请求对象：获取日志
// ================================
message GetLogRequest {
    string containerId = 1; // 目标容器ID
    int32 num = 2;          // 获取最新日志行数
}

// ================================
// 响应对象：日志内容
// ================================
message GetLogResp {
    string logContent = 1; // 日志内容
}

// ================================
// 请求对象：导出容器数据
// ================================
message ExportContainerDataRequest {
    string containerId = 1; // 目标容器ID
    string exportDir = 2;   // 容器内部要导出的目录
}

// ================================
// 响应对象：导出容器数据结果
// ================================
message ExportContainerDataResp {
    bytes zipFile = 1;       // 导出的压缩包内容
    string fileName = 2;     // 压缩包文件名
}

// ================================
// 服务定义
// ================================
service TaskAssignService {
    // 停止指定 Docker 容器
    rpc StopDockerContainer(StopDockerContainerRequest) returns (google.protobuf.Empty);

    // 上传 Docker 镜像并启动容器，返回容器信息
    rpc UpDockerImage(UpDockerImageRequest) returns (DContainerInfoResp);

    // 获取容器最新日志
    rpc GetLog(GetLogRequest) returns (GetLogResp);

    // 导出容器指定目录为压缩包
    rpc ExportContainerData(ExportContainerDataRequest) returns (ExportContainerDataResp);
}
